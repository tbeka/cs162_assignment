{% for item in list.items if item.parent_id is none %}
    <div class="card" draggable="true" ondragstart="drag(event)" id="task-{{ item.id }}" style="margin-bottom: 10px;">
        <div class="card-content">
            <div class="content" style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
                <div id="title-container-{{ item.id }}" style="width: 100%;">
                    <h2 class="title is-4" style="color: black; display: inline-block;">{{ item.content }}</h2>
                </div>
                <form id="edit-task-form-{{ item.id }}" action="{{ url_for('main.update_task', item_id=item.id) }}" method="post" style="display: none; width: 50%;">
                    <input type="text" class="input is-small" name="new_content" value="{{ item.content }}">
                    <button type="submit" class="button is-small is-info">Save</button>
                </form>
            </div>
        </div>
        <div class="buttons are-small" style="position: absolute; top: 10px; left: 10px;">
        {% if item.children %}
            <button class="button is-small is-light" onclick="toggleExpandCollapse('{{ item.id }}')">Expand/Collapse</button>
        {% endif %}
        </div>
        <div class="buttons are-small" style="position: absolute; top: 10px; right: 10px;">
            <button class="button is-info is-small" onclick="toggleAddTaskForm('add-subtask-form-{{ item.id }}')">Add Subtask</button>
            <a href="javascript:void(0);" onclick="toggleEditTask('{{ item.id }}')" class="button is-small is-light">Rename</a>
            <form action="{{ url_for('main.delete_task', item_id=item.id) }}" method="post" style="display: inline;">
                <button type="submit" class="button is-small is-light">Delete</button>
            </form>
        </div>
        <div id="add-subtask-form-{{ item.id }}" style="display: none; margin: 0 auto; width: 80%;">
            <form action="{{ url_for('main.add_task', list_id=list.id) }}" method="post">
                <input type="hidden" name="parent_id" value="{{ item.id }}">
                <div class="field">
                    <div class="control">
                        <input class="input" type="text" name="taskContent" placeholder="Enter new subtask" required>
                    </div>
                </div>
                <div class="field">
                    <div class="control has-text-centered">
                        <button type="submit" class="button is-small is-info" style="margin-bottom: 20px;">Add Subtask</button>
                    </div>
                </div>
            </form>
        </div>
        {% if item.children %}
            <ul id="subtasks-{{ item.id }}" style="display: {{'none' if item.is_collapsed else 'block'}}; margin-left: 20px; margin-right: 20px">
                {% for sub_item in item.children %}
                <li>
                    <div class="card" style="margin-bottom: 10px;">
                        <div class="card-content">
                            <div class="content" style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
                                <div id="title-container-{{ sub_item.id }}" style="width: 100%;">
                                    <h2 class="title is-5" style="color: black; display: inline-block;">{{ sub_item.content }}</h2>
                                </div>
                                <form id="edit-task-form-{{ sub_item.id }}" action="{{ url_for('main.update_task', item_id=sub_item.id) }}" method="post" style="display: none; width: 50%;">
                                    <input type="text" class="input is-small" name="new_content" value="{{ sub_item.content }}">
                                    <button type="submit" class="button is-small is-info">Save</button>
                                </form>
                            </div>
                        </div>
                        <div class="buttons are-small" style="position: absolute; top: 10px; left: 10px;">
                        {% if sub_item.children %}
                            <button class="button is-small is-light" onclick="toggleExpandCollapse('{{ sub_item.id }}')">Expand/Collapse</button>
                        {% endif %}
                        </div>
                        <div class="buttons are-small" style="position: absolute; top: 10px; right: 10px;">
                            <button class="button is-info is-small" onclick="toggleAddTaskForm('add-subtask-form-{{ sub_item.id }}')">Add Subtask</button>
                            <a href="javascript:void(0);" onclick="toggleEditTask('{{ sub_item.id }}')" class="button is-small is-light">Rename</a>
                            <form action="{{ url_for('main.delete_task', item_id=sub_item.id) }}" method="post" style="display: inline;">
                                <button type="submit" class="button is-small is-light">Delete</button>
                            </form>
                        </div>
                        <div id="add-subtask-form-{{ sub_item.id }}" style="display: none; margin: 0 auto; width: 80%;">
                            <form action="{{ url_for('main.add_task', list_id=list.id, parent_id=sub_item.id) }}" method="post">
                                <input type="hidden" name="parent_id" value="{{ sub_item.id }}">
                                <div class="field">
                                    <div class="control">
                                        <input class="input" type="text" name="taskContent" placeholder="Enter new sub-subtask" required>
                                    </div>
                                </div>
                                <div class="field">
                                    <div class="control has-text-centered">
                                        <button type="submit" class="button is-small is-info" style="margin-bottom: 20px;">Add subtask</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        {% if sub_item.children %}
                            <ul id="subtasks-{{ sub_item.id }}" style="display: {{'none' if sub_item.is_collapsed else 'block'}}; margin-left: 20px; margin-right: 20px;">
                                {% for sub_sub_item in sub_item.children %}
                                <li>
                                    <div class="card" style="margin-bottom: 10px;">
                                        <div class="card-content">
                                            <div class="content" style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
                                                <div id="title-container-{{ sub_sub_item.id }}" style="width: 100%;">
                                                    <h2 class="title is-6" style="color: black; display: inline-block;">{{ sub_sub_item.content }}</h2>
                                                </div>
                                                <form id="edit-task-form-{{ sub_sub_item.id }}" action="{{ url_for('main.update_task', item_id=sub_sub_item.id) }}" method="post" style="display: none; width: 50%;">
                                                    <input type="text" class="input is-small" name="new_content" value="{{ sub_sub_item.content }}">
                                                    <button type="submit" class="button is-small is-info">Save</button>
                                                </form>
                                            </div>
                                        </div>
                                        <div class="buttons are-small" style="position: absolute; top: 10px; right: 10px;">
                                            <a href="javascript:void(0);" onclick="toggleEditTask('{{ sub_sub_item.id }}')" class="button is-small is-light">Rename</a>
                                            <form action="{{ url_for('main.delete_task', item_id=sub_sub_item.id) }}" method="post" style="display: inline;">
                                                <button type="submit" class="button is-small is-light">Delete</button>
                                            </form>
                                        </div>
                                    </div>
                                </li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                </li>
                {% endfor %}
            </ul>
        {% endif %} 
    </div>
{% endfor %}